<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RJP MegaStore ‚Äì Online Shopping</title>
<meta name="description" content="Amazon‚Äëstyle e‚Äëcommerce MVP with catalog, search, cart, checkout, orders, reviews, and admin panel in a single HTML file." />
<style>
  :root{
    --bg:#0f1115;--card:#121722;--muted:#a7b0c7;--text:#eaf0ff;--pri:#ffb84d;--pri2:#ffc76e;--acc:#62e1b5;--red:#ff6b6b;--ring:0 0 0 3px rgba(255,184,77,.35)
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(900px 600px at -10% -10%,rgba(98,225,181,.08),transparent 60%),radial-gradient(1000px 700px at 120% -10%,rgba(255,184,77,.08),transparent 60%),var(--bg);color:var(--text)}
  a{color:var(--text)}
  .container{max-width:1200px;margin-inline:auto;padding:16px}
  .nav{position:sticky;top:0;z-index:30;background:rgba(18,23,34,.9);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.08)}
  .nav-inner{display:grid;grid-template-columns:200px 1fr auto;gap:12px;align-items:center;padding:10px 16px}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--pri),#40e0b8);display:grid;place-items:center;color:#111;font-weight:900;box-shadow:0 6px 24px rgba(255,184,77,.35)}
  .brand h1{font-size:20px;margin:0}
  .search{display:flex;gap:8px}
  .input{flex:1;background:#0e1424;border:1px solid #283356;color:var(--text);padding:10px 12px;border-radius:10px}
  .btn{background:#1a2340;color:var(--text);border:1px solid #2a386b;padding:10px 14px;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
  .btn:hover{box-shadow:var(--ring)}
  .btn.pri{background:linear-gradient(180deg,var(--pri),var(--pri2));color:#111;border-color:transparent;font-weight:700}

  .layout{display:grid;grid-template-columns:260px 1fr;gap:16px;margin-top:16px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:14px}
  .products{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}
  .product{display:flex;flex-direction:column;gap:8px}
  .img{aspect-ratio:1/1;border-radius:12px;overflow:hidden;background:#0c1326;display:grid;place-items:center}
  .img img{width:100%;height:100%;object-fit:cover}
  .price{font-weight:800}
  .strike{text-decoration:line-through;opacity:.7;margin-left:6px}
  .mini{font-size:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;border:1px solid rgba(255,255,255,.12);padding:4px 8px;border-radius:999px}
  .qty{display:inline-flex;align-items:center;gap:8px}
  .qty button{width:28px;height:28px}

  .tabs{display:flex;gap:8px;margin-bottom:8px}
  .tabs button{background:#12192f}
  .tabs button.active{background:linear-gradient(180deg,var(--pri),var(--pri2));color:#111;border-color:transparent;font-weight:700}

  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px;text-align:left}

  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;place-items:center;padding:16px;z-index:50}
  .modal.open{display:grid}
  .modal-card{background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:16px;max-width:900px;width:100%}

  .footer{margin-top:30px;padding:24px 0;border-top:1px solid rgba(255,255,255,.08);color:var(--muted)}

  @media (max-width:900px){.layout{grid-template-columns:1fr}}
</style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="nav-inner container">
      <div class="brand"><div class="logo">R</div><h1>RJP MegaStore</h1></div>
      <div class="search">
        <input id="searchInput" class="input" placeholder="Search for products, brands and more‚Ä¶" />
        <button class="btn" onclick="doSearch()">Search</button>
      </div>
      <div class="row">
        <button class="btn" onclick="openWishlist()">‚ù§ Wishlist <span id="wishCount" class="mini"></span></button>
        <button class="btn" onclick="openCart()">üõí Cart <span id="cartCount" class="mini"></span></button>
        <button class="btn" onclick="openAuth()">üë§ <span id="authBtnText">Sign In</span></button>
      </div>
    </div>
  </div>

  <div class="container layout">
    <!-- SIDEBAR -->
    <aside class="card" id="filters">
      <h3 style="margin:4px 0 8px">Filters</h3>
      <div class="grid">
        <div>
          <div class="mini muted">Category</div>
          <div id="catFilters" class="row"></div>
        </div>
        <div>
          <div class="mini muted">Price</div>
          <div class="row">
            <input id="minPrice" class="input" type="number" placeholder="Min"/>
            <input id="maxPrice" class="input" type="number" placeholder="Max"/>
          </div>
        </div>
        <div>
          <div class="mini muted">Rating</div>
          <div class="row" id="ratingFilters"></div>
        </div>
        <button class="btn" onclick="applyFilters()">Apply Filters</button>
        <button class="btn" onclick="clearFilters()">Clear</button>
      </div>
      <!--<hr style="border-color:rgba(255,255,255,.08)">
      <div class="grid">
        <h3 style="margin:4px 0 8px">Admin Panel</h3>
        <button class="btn" onclick="openAdmin()">Add / Manage Products</button>
        <button class="btn" onclick="openOrders()">Orders</button>
      </div>-->

<!-- Admin User Button --><br>
<button onclick="openPopup()">Admin User</button>

<!-- Login Popup -->
<div class="popup-overlay" id="popup">
    <div class="popup-box">
        <h2>Admin Login</h2>
        <input type="text" id="userid" placeholder="User ID">
        <input type="password" id="password" placeholder="Password">
        <button class="btn" onclick="checkLogin()">Login</button>
        <button class="btn close-btn" onclick="closePopup()">Close</button>
    </div>
</div>

<!-- Success Popup -->
<div class="popup-overlay" id="successPopup">
    <div class="popup-box">
        <h2> HELLO RJP SOLITION  üëã</h2>
        <p>Welcome to the Admin Panel.</p>
          <hr style="border-color:rgba(255,255,255,.08)">
      <div class="grid">
        <h3 style="margin:4px 0 8px">Admin Panel</h3>
        <button class="btn" onclick="openAdmin()">Add / Manage Products</button>
        <button class="btn" onclick="openOrders()">Orders</button>
      </div>

        <button class="btn close-btn" onclick="closeSuccess()">Close</button>
    </div>
</div>

    </aside>


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin User Login Popup</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
    }
    button {
        padding: 10px 20px;
        background: #007BFF;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }
    button:hover {
        background: #0056b3;
    }
    /* Popup Background */
    .popup-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 999;
    }
    /* Popup Box */
    .popup-box {
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        box-shadow: 0px 0px 10px rgba(0,0,0,0.3);
        animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
        from {opacity: 0; transform: scale(0.9);}
        to {opacity: 1; transform: scale(1);}
    }
    .popup-box h2 {
        text-align: center;
        margin-bottom: 20px;
    }
    .popup-box input {
        width: 100%;
        padding: 8px;
        margin: 5px 0 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    .popup-box .btn {
        width: 100%;
        padding: 10px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .popup-box .btn:hover {
        background: #218838;
    }
    .close-btn {
        background: #dc3545;
        margin-top: 10px;
    }
    .close-btn:hover {
        background: #b52b36;
    }
</style>

    <!-- MAIN / CATALOG -->
    <main>
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h2 style="margin:0">Deals & Bestsellers</h2>
          <div class="row mini">
            <span class="badge">Free Delivery on ‚Çπ499+</span>
            <span class="badge">7‚Äëday Return</span>
            <span class="badge">Secure Payments</span>
          </div>
        </div>
      </div>
      <div id="productGrid" class="grid products" style="margin-top:12px"></div>
    </main>
  </div>

  <!-- MODALS -->
  <!-- Product Modal -->
  <div class="modal" id="productModal"><div class="modal-card" id="productDetail"></div></div>
  <!-- Cart Modal -->
  <div class="modal" id="cartModal"><div class="modal-card" id="cartCard"></div></div>
  <!-- Wishlist Modal -->
  <div class="modal" id="wishModal"><div class="modal-card" id="wishCard"></div></div>
  <!-- Auth Modal -->
  <div class="modal" id="authModal"><div class="modal-card" id="authCard"></div></div>
  <!-- Admin Modal -->
  <div class="modal" id="adminModal"><div class="modal-card" id="adminCard"></div></div>
  <!-- Orders Modal -->
  <div class="modal" id="ordersModal"><div class="modal-card" id="ordersCard"></div></div>

  <footer class="footer">
    <div class="container" style="padding:0;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>¬© <span id="year"></span> RJP MegaStore</div>
      <div class="muted">This is an Amazon‚Äëlike MVP for demonstration. Replace sample data, connect your backend, and launch.</div>
    </div>
  </footer>

<script>
    function openPopup() {
        document.getElementById("popup").style.display = "flex";
    }
    function closePopup() {
        document.getElementById("popup").style.display = "none";
    }
    function checkLogin() {
        let user = document.getElementById("userid").value;
        let pass = document.getElementById("password").value;
        if(user === "admin" && pass === "1234") {
            closePopup();
            document.getElementById("successPopup").style.display = "flex";
        } else {
            alert("Invalid credentials ‚ùå");
        }
    }
    function closeSuccess() {
        document.getElementById("successPopup").style.display = "none";
    }
</script>


<script>
/* ===================== CONFIG ===================== */
const APPS_SCRIPT_ORDERS_URL = '';// optional GAS Web App to receive orders
const APPS_SCRIPT_PRODUCTS_URL = '';// optional GAS Web App to sync products
const STORE_NAME = 'RJP MegaStore';
const UPI_ID = 'rjpstore@upi'; // change to your UPI ID
const UPI_NAME = 'RJP Store';

/* ===================== SAMPLE DATA ===================== */
const SAMPLE_PRODUCTS = [
  {id:'p1', title:'Wireless Headphones', price:1999, mrp:2999, rating:4.4, stock:34, category:'Electronics', img:'https://images.unsplash.com/photo-1518441902110-23739b045db5?q=80&w=600&auto=format&fit=crop'},
  {id:'p2', title:'Smart Watch Pro', price:2499, mrp:3999, rating:4.1, stock:18, category:'Electronics', img:'https://images.unsplash.com/photo-1524805444758-089113d48a6d?q=80&w=600&auto=format&fit=crop'},
  {id:'p3', title:'Cotton T‚ÄëShirt', price:399, mrp:799, rating:4.0, stock:120, category:'Fashion', img:'https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=600&auto=format&fit=crop'},
  {id:'p4', title:'Running Shoes', price:1599, mrp:2499, rating:4.3, stock:52, category:'Fashion', img:'https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=600&auto=format&fit=crop'},
  {id:'p5', title:'Mixer Grinder 750W', price:3299, mrp:4499, rating:4.2, stock:26, category:'Home & Kitchen', img:'https://images.unsplash.com/photo-1542444459-db63c49c2c34?q=80&w=600&auto=format&fit=crop'},
  {id:'p6', title:'Office Chair Ergonomic', price:4999, mrp:6999, rating:4.5, stock:10, category:'Home & Kitchen', img:'https://images.unsplash.com/photo-1582582429416-78f521197822?q=80&w=600&auto=format&fit=crop'},
  {id:'p7', title:'Android Smartphone 6.5"', price:10999, mrp:12999, rating:4.1, stock:9, category:'Mobiles', img:'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=600&auto=format&fit=crop'},
  {id:'p8', title:'USB‚ÄëC Power Bank 20k', price:1899, mrp:2499, rating:4.6, stock:44, category:'Electronics', img:'https://images.unsplash.com/photo-1587474260584-136574528ed5?q=80&w=600&auto=format&fit=crop'}
];

/* ===================== STATE ===================== */
let state = {
  products: load('products') || SAMPLE_PRODUCTS,
  cart: load('cart') || [],
  wishlist: load('wishlist') || [],
  user: load('user') || null,
  orders: load('orders') || [],
  reviews: load('reviews') || {} // {productId:[{user,stars,text,date}]}
};

/* ===================== UTIL ===================== */
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
function load(k){try{return JSON.parse(localStorage.getItem(k))}catch{return null}}
function inr(n){return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0}).format(n)}
function percentOff(mrp,price){return Math.round(100-(price/mrp*100))}
function uid(prefix='ID'){return prefix+'-'+Math.random().toString(36).slice(2,8)+Date.now().toString().slice(-4)}

/* ===================== RENDER: CATALOG ===================== */
function renderCategories(){
  const cats = [...new Set(state.products.map(p=>p.category))].sort()
  const h = cats.map(c=>`<label class="badge"><input type="checkbox" value="${c}" onchange="applyFilters()"> ${c}</label>`).join('')
  document.getElementById('catFilters').innerHTML = h
}
function renderRatingFilters(){
  const h=[5,4,3].map(r=>`<label class="badge"><input type="radio" name="rf" value="${r}" onchange="applyFilters()"> ${r}+ ‚òÖ</label>`).join('')+`<label class="badge"><input type="radio" name="rf" value="" checked onchange="applyFilters()"> Any</label>`
  document.getElementById('ratingFilters').innerHTML=h
}
function productCard(p){
  const off=percentOff(p.mrp,p.price)
  return `<div class="card product">
    <div class="img" onclick="openProduct('${p.id}')"><img src="${p.img}" alt="${p.title}"></div>
    <div style="display:flex;justify-content:space-between;gap:8px;align-items:flex-start">
      <div style="flex:1">
        <div title="${p.title}" style="font-weight:700;line-height:1.2">${p.title}</div>
        <div class="mini">${p.rating} ‚òÖ ‚Ä¢ ${p.category}</div>
        <div><span class="price">${inr(p.price)}</span> <span class="strike mini">${inr(p.mrp)}</span> <span class="mini" style="color:var(--acc)">${off}% off</span></div>
      </div>
      <button class="btn pri" onclick="addToCart('${p.id}')">Add</button>
    </div>
    <div class="row mini">
      <button class="btn" onclick="toggleWish('${p.id}')">‚ù§ Wish</button>
      <button class="btn" onclick="openProduct('${p.id}')">Details</button>
    </div>
  </div>`
}
function renderGrid(list){
  const g=document.getElementById('productGrid');
  g.innerHTML=list.map(productCard).join('')||`<div class="card">No products found.</div>`
}

/* ===================== SEARCH & FILTER ===================== */
function doSearch(){
  const q=document.getElementById('searchInput').value.toLowerCase().trim()
  const list=state.products.filter(p=>[p.title,p.category].join(' ').toLowerCase().includes(q))
  renderGrid(list)
}
function applyFilters(){
  const q=document.getElementById('searchInput').value.toLowerCase().trim()
  const min=Number(document.getElementById('minPrice').value||0)
  const max=Number(document.getElementById('maxPrice').value||1e9)
  const rc=document.querySelector('input[name=rf]:checked')?.value||''
  const cats=[...document.querySelectorAll('#catFilters input:checked')].map(i=>i.value)
  const list=state.products.filter(p=>{
    const okQ=q? (p.title.toLowerCase().includes(q)||p.category.toLowerCase().includes(q)):true
    const okP=p.price>=min && p.price<=max
    const okR=rc? p.rating>=Number(rc):true
    const okC=cats.length? cats.includes(p.category):true
    return okQ && okP && okR && okC
  })
  renderGrid(list)
}
function clearFilters(){
  document.getElementById('searchInput').value='';
  document.getElementById('minPrice').value='';
  document.getElementById('maxPrice').value='';
  document.querySelectorAll('#catFilters input').forEach(i=>i.checked=false)
  document.querySelector('input[name=rf][value=""]').checked=true
  renderGrid(state.products)
}

/* ===================== PRODUCT DETAILS ===================== */
function openProduct(id){
  const p=state.products.find(x=>x.id===id); if(!p) return
  const revs=(state.reviews[id]||[]).slice().reverse()
  const html=`<div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap">
    <h3 style="margin:6px 0">${p.title}</h3>
    <button class="btn" onclick="closeModal('productModal')">Close</button>
  </div>
  <div class="grid" style="grid-template-columns:320px 1fr">
    <div class="card"><img src="${p.img}" alt="${p.title}" style="width:100%;border-radius:12px"></div>
    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div>
            <div class="price">${inr(p.price)} <span class="strike mini">${inr(p.mrp)}</span></div>
            <div class="mini muted">${p.rating} ‚òÖ ‚Ä¢ ${p.category} ‚Ä¢ Stock: ${p.stock}</div>
          </div>
          <button class="btn pri" onclick="addToCart('${p.id}')">Add to Cart</button>
        </div>
        <div style="margin-top:8px" class="mini">Free Delivery on orders ‚Çπ499+ ‚Ä¢ 7‚Äëday Return ‚Ä¢ Secure Payment</div>
      </div>
      <div class="card">
        <h4 style="margin:6px 0">Ratings & Reviews</h4>
        <form onsubmit="event.preventDefault(); submitReview('${p.id}')" class="row" style="align-items:center">
          <select id="revStars" class="input" style="max-width:120px">
            <option value="5">5 ‚òÖ</option><option value="4">4 ‚òÖ</option><option value="3">3 ‚òÖ</option><option value="2">2 ‚òÖ</option><option value="1">1 ‚òÖ</option>
          </select>
          <input id="revText" class="input" placeholder="Write your review"/>
          <button class="btn">Post</button>
        </form>
        <div id="revList">${revs.map(r=>`<div class='card'><strong>${r.user||'User'}</strong> ‚Äì ${r.stars} ‚òÖ<div class='mini muted'>${new Date(r.date).toLocaleString()}</div><div>${r.text}</div></div>`).join('')||'<div class="mini muted">No reviews yet.</div>'}</div>
      </div>
    </div>
  </div>`
  document.getElementById('productDetail').innerHTML=html
  openModal('productModal')
}
function submitReview(pid){
  const stars=Number(document.getElementById('revStars').value)
  const text=document.getElementById('revText').value.trim(); if(!text) return
  const user=state.user?.name||'Guest'
  state.reviews[pid]=state.reviews[pid]||[]
  state.reviews[pid].push({user,stars,text,date:new Date().toISOString()})
  save('reviews',state.reviews)
  openProduct(pid)
}

/* ===================== CART ===================== */
function addToCart(id){
  const p=state.products.find(x=>x.id===id); if(!p||p.stock<1) return
  const item=state.cart.find(x=>x.id===id)
  if(item){ if(item.qty<p.stock) item.qty++; } else { state.cart.push({id:p.id,title:p.title,price:p.price,img:p.img,qty:1}) }
  save('cart',state.cart); updateCartBadge()
}
function updateCartBadge(){
  const c=state.cart.reduce((s,i)=>s+i.qty,0)
  document.getElementById('cartCount').textContent=c?`(${c})`:''
  const w=state.wishlist.length; document.getElementById('wishCount').textContent=w?`(${w})`:''
}
function openCart(){
  const items=state.cart.map(i=>`<tr><td style='width:56px'><img src='${i.img}' style='width:56px;height:56px;object-fit:cover;border-radius:8px'></td><td>${i.title}</td><td>${inr(i.price)}</td><td class='qty'><button class='btn' onclick="chgQty('${i.id}',-1)">‚àí</button><span>${i.qty}</span><button class='btn' onclick="chgQty('${i.id}',1)">+</button></td><td>${inr(i.price*i.qty)}</td><td><button class='btn' onclick="rmCart('${i.id}')">Remove</button></td></tr>`).join('')
  const total=state.cart.reduce((s,i)=>s+i.price*i.qty,0)
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>Your Cart</h3><button class='btn' onclick="closeModal('cartModal')">Close</button></div>
  <div class='card'><table><thead><tr><th></th><th>Item</th><th>Price</th><th>Qty</th><th>Total</th><th></th></tr></thead><tbody>${items||`<tr><td colspan='6' class='muted'>Cart is empty</td></tr>`}</tbody></table></div>
  <div class='card'>
    <div class='row' style='justify-content:space-between;align-items:center'>
      <div><strong>Subtotal:</strong> ${inr(total)}</div>
      <button class='btn pri' ${total?'':'disabled'} onclick='openCheckout()'>Proceed to Checkout</button>
    </div>
  </div>`
  document.getElementById('cartCard').innerHTML=html
  openModal('cartModal')
}
function chgQty(id,delta){
  const it=state.cart.find(i=>i.id===id); if(!it) return; it.qty=Math.max(1,it.qty+delta); if(it.qty===0) state.cart=state.cart.filter(i=>i.id!==id)
  save('cart',state.cart); openCart(); updateCartBadge()
}
function rmCart(id){ state.cart=state.cart.filter(i=>i.id!==id); save('cart',state.cart); openCart(); updateCartBadge() }

/* ===================== CHECKOUT ===================== */
function openCheckout(){
  const total=state.cart.reduce((s,i)=>s+i.price*i.qty,0)
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>Checkout</h3><button class='btn' onclick="closeModal('cartModal')">Close</button></div>
  <div class='grid' style='grid-template-columns:1fr 360px'>
    <form id='chkForm' class='card'>
      <h4>Shipping Details</h4>
      <input class='input' name='name' placeholder='Full Name' required>
      <input class='input' name='phone' placeholder='Phone (10‚Äëdigit)' pattern='[0-9]{10}' required>
      <input class='input' name='email' type='email' placeholder='Email'>
      <textarea class='input' name='address' placeholder='Address, City, PIN' required></textarea>
      <h4>Payment</h4>
      <select class='input' name='pay' id='payMethod'>
        <option value='UPI' selected>UPI</option>
        <option value='COD'>Cash on Delivery</option>
        <option value='Card'>Card (link)</option>
      </select>
      <div id='payUI' class='mini muted'></div>
      <button class='btn pri' type='submit'>Place Order (${inr(total)})</button>
    </form>
    <div class='card'>
      <h4>Order Summary</h4>
      ${state.cart.map(i=>`<div class='row' style='justify-content:space-between'><div>${i.title} √ó ${i.qty}</div><div>${inr(i.price*i.qty)}</div></div>`).join('')}
      <hr style='border-color:rgba(255,255,255,.08)'>
      <div class='row' style='justify-content:space-between'><strong>Total</strong><strong>${inr(total)}</strong></div>
    </div>
  </div>`
  document.getElementById('cartCard').innerHTML=html
  document.getElementById('payMethod').addEventListener('change',renderPayUI)
  renderPayUI()
  document.getElementById('chkForm').addEventListener('submit',placeOrder)
}
function renderPayUI(){
  const m=document.getElementById('payMethod').value
  const total=state.cart.reduce((s,i)=>s+i.price*i.qty,0)
  const upiLink=`upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(UPI_NAME)}&am=${total}&cu=INR&tn=${encodeURIComponent('Order payment at '+STORE_NAME)}`
  const box=document.getElementById('payUI')
  if(m==='UPI'){
    box.innerHTML=`Pay securely via UPI. <a class='btn pri' href='${upiLink}'>Pay Now</a> (opens your UPI app)`
  }else if(m==='Card'){
    box.innerHTML='You will receive a secure payment link via SMS/Email after placing the order.'
  }else{box.innerHTML='Pay cash to delivery partner.'}
}
async function placeOrder(e){
  e.preventDefault()
  const fd=new FormData(e.target)
  const customer=Object.fromEntries(fd.entries())
  const order={id:uid('ORD'),date:new Date().toISOString(),customer,items:state.cart,total:state.cart.reduce((s,i)=>s+i.price*i.qty,0),status:'Placed'}
  state.orders.unshift(order); save('orders',state.orders)
  // reduce stock
  order.items.forEach(it=>{const p=state.products.find(x=>x.id===it.id); if(p) p.stock=Math.max(0,p.stock-it.qty)})
  save('products',state.products)
  // send to Google Sheet (optional)
  if(APPS_SCRIPT_ORDERS_URL){ try{ await fetch(APPS_SCRIPT_ORDERS_URL,{method:'POST',body:JSON.stringify(order)}) }catch(err){ console.warn('GAS error',err) } }
  state.cart=[]; save('cart',state.cart); updateCartBadge(); openOrders(order.id)
  closeModal('cartModal')
}

/* ===================== WISHLIST ===================== */
function toggleWish(id){
  if(state.wishlist.includes(id)) state.wishlist=state.wishlist.filter(x=>x!==id); else state.wishlist.push(id)
  save('wishlist',state.wishlist); updateCartBadge()
}
function openWishlist(){
  const list=state.products.filter(p=>state.wishlist.includes(p.id))
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>Wishlist</h3><button class='btn' onclick="closeModal('wishModal')">Close</button></div>
  <div class='grid products'>${list.map(productCard).join('')||'<div class="card">Wishlist is empty.</div>'}</div>`
  document.getElementById('wishCard').innerHTML=html; openModal('wishModal')
}

/* ===================== AUTH (Mock) ===================== */
function openAuth(){
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>${state.user?'Account':'Sign In'}</h3><button class='btn' onclick="closeModal('authModal')">Close</button></div>
  <div class='card'>
    ${state.user? `<div>Signed in as <strong>${state.user.name}</strong> (${state.user.phone||''})</div>
      <div class='row' style='margin-top:8px'><button class='btn' onclick='openOrders()'>My Orders</button><button class='btn' onclick='logout()'>Sign Out</button></div>`:
      `<form id='authForm' class='grid'>
        <input class='input' name='name' placeholder='Your Name' required>
        <input class='input' name='phone' placeholder='Phone (optional)'>
        <input class='input' name='email' type='email' placeholder='Email (optional)'>
        <button class='btn pri'>Continue</button>
      </form>`}
  </div>`
  document.getElementById('authCard').innerHTML=html; openModal('authModal')
  const f=document.getElementById('authForm'); if(f){f.addEventListener('submit',e=>{e.preventDefault(); const fd=new FormData(f); state.user=Object.fromEntries(fd.entries()); save('user',state.user); updateAuthBtn(); closeModal('authModal')})}
}
function updateAuthBtn(){ document.getElementById('authBtnText').textContent=state.user? 'Account':'Sign In' }
function logout(){ state.user=null; save('user',state.user); updateAuthBtn(); closeModal('authModal') }

/* ===================== ORDERS ===================== */
function openOrders(highlightId=null){
  const rows=state.orders.map(o=>`<tr ${highlightId===o.id?"style='outline:2px solid var(--pri);'":''}><td>${o.id}</td><td>${new Date(o.date).toLocaleString()}</td><td>${o.customer?.name||'-'}</td><td>${inr(o.total)}</td><td>${o.status}</td><td><button class='btn' onclick="viewOrder('${o.id}')">View</button></td></tr>`).join('')
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>Orders</h3><button class='btn' onclick="closeModal('ordersModal')">Close</button></div>
  <div class='card'><table><thead><tr><th>Order ID</th><th>Date</th><th>Customer</th><th>Total</th><th>Status</th><th></th></tr></thead><tbody>${rows||`<tr><td colspan='6' class='muted'>No orders yet.</td></tr>`}</tbody></table></div>`
  document.getElementById('ordersCard').innerHTML=html; openModal('ordersModal')
}
function viewOrder(id){
  const o=state.orders.find(x=>x.id===id); if(!o) return
  const items=o.items.map(i=>`<tr><td>${i.title}</td><td>${i.qty}</td><td>${inr(i.price)}</td><td>${inr(i.price*i.qty)}</td></tr>`).join('')
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>Order ${o.id}</h3><button class='btn' onclick='openOrders()'>Back</button></div>
  <div class='grid' style='grid-template-columns:1fr 1fr'>
    <div class='card'><h4>Items</h4><table><thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead><tbody>${items}</tbody></table></div>
    <div class='card'><h4>Customer</h4><div>${o.customer.name}</div><div class='mini muted'>${o.customer.phone||''}</div><div class='mini muted'>${o.customer.email||''}</div><div style='margin-top:6px'>${o.customer.address}</div><hr style='border-color:rgba(255,255,255,.08)'><div><strong>Total:</strong> ${inr(o.total)}</div><div><strong>Status:</strong> ${o.status}</div></div>
  </div>`
  document.getElementById('ordersCard').innerHTML=html
}

/* ===================== ADMIN ===================== */
function openAdmin(){
  const rows=state.products.map(p=>`<tr><td>${p.id}</td><td>${p.title}</td><td>${p.category}</td><td>${inr(p.price)}</td><td>${p.stock}</td><td><button class='btn' onclick="editProduct('${p.id}')">Edit</button> <button class='btn' onclick="delProduct('${p.id}')">Delete</button></td></tr>`).join('')
  const html=`<div style='display:flex;justify-content:space-between;align-items:center'><h3 style='margin:6px 0'>Products</h3><button class='btn' onclick="closeModal('adminModal')">Close</button></div>
  <div class='grid'>
    <form id='prodForm' class='card'>
      <h4 id='pfTitle'>Add Product</h4>
      <input class='input' name='id' placeholder='ID (auto)' readonly value='${uid('p')}'>
      <input class='input' name='title' placeholder='Title' required>
      <input class='input' name='category' placeholder='Category' required>
      <input class='input' name='price' type='number' placeholder='Price' required>
      <input class='input' name='mrp' type='number' placeholder='MRP' required>
      <input class='input' name='rating' type='number' step='0.1' placeholder='Rating (1-5)' value='4.2'>
      <input class='input' name='stock' type='number' placeholder='Stock' value='10'>
      <input class='input' name='img' placeholder='Image URL'>
      <button class='btn pri'>Save Product</button>
    </form>
    <div class='card'>
      <div style='display:flex;justify-content:space-between;align-items:center'><h4>All Products</h4>
        <div class='row mini'>
          <input type='file' id='csvFile' accept='.csv' class='input' style='width:220px'>
          <button class='btn' onclick='importCSV()'>Import CSV</button>
          <button class='btn' onclick='exportCSV()'>Export CSV</button>
        </div>
      </div>
      <table><thead><tr><th>ID</th><th>Title</th><th>Category</th><th>Price</th><th>Stock</th><th></th></tr></thead><tbody id='prodRows'>${rows}</tbody></table>
    </div>
  </div>`
  document.getElementById('adminCard').innerHTML=html; openModal('adminModal')
  document.getElementById('prodForm').addEventListener('submit',saveProduct)
}
function saveProduct(e){
  e.preventDefault(); const fd=new FormData(e.target); const p=Object.fromEntries(fd.entries());
  p.price=Number(p.price); p.mrp=Number(p.mrp); p.rating=Number(p.rating); p.stock=Number(p.stock)
  const ex=state.products.find(x=>x.id===p.id)
  if(ex){ Object.assign(ex,p) } else { state.products.unshift(p) }
  save('products',state.products); closeModal('adminModal'); renderCategories(); applyFilters()
  if(APPS_SCRIPT_PRODUCTS_URL){ try{ fetch(APPS_SCRIPT_PRODUCTS_URL,{method:'POST',body:JSON.stringify({action:'UPSERT',product:p})}) }catch(err){} }
}
function editProduct(id){
  const p=state.products.find(x=>x.id===id); if(!p) return; openAdmin();
  const f=document.getElementById('prodForm'); document.getElementById('pfTitle').textContent='Edit Product';
  Object.entries(p).forEach(([k,v])=>{ if(f[k]) f[k].value=v })
}
function delProduct(id){ if(!confirm('Delete this product?')) return; state.products=state.products.filter(x=>x.id!==id); save('products',state.products); openAdmin(); renderCategories(); applyFilters() }
function importCSV(){
  const f=document.getElementById('csvFile').files[0]; if(!f) return alert('Choose a CSV first')
  const reader=new FileReader(); reader.onload=()=>{
    const rows=reader.result.split(/\r?\n/).filter(Boolean).map(r=>r.split(','))
    const [head,...data]=rows; const idx=Object.fromEntries(head.map((h,i)=>[h.trim(),i]))
    const list=data.map(r=>({
      id:r[idx.id]||uid('p'), title:r[idx.title]||'', category:r[idx.category]||'General', price:Number(r[idx.price]||0), mrp:Number(r[idx.mrp]||0), rating:Number(r[idx.rating]||4), stock:Number(r[idx.stock]||0), img:r[idx.img]||''
    }))
    state.products=list; save('products',state.products); openAdmin(); renderCategories(); applyFilters()
  }; reader.readAsText(f)
}
function exportCSV(){
  const head=['id','title','category','price','mrp','rating','stock','img']
  const rows=state.products.map(p=>head.map(h=>String(p[h]??'').replaceAll(',',' ')).join(','))
  const csv=[head.join(','),...rows].join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='products.csv'; a.click()
}

/* ===================== MODAL HELPERS ===================== */
function openModal(id){document.getElementById(id).classList.add('open')}
function closeModal(id){document.getElementById(id).classList.remove('open')}

/* ===================== INIT ===================== */
function init(){
  document.getElementById('year').textContent=new Date().getFullYear()
  renderCategories(); renderRatingFilters(); renderGrid(state.products); updateCartBadge(); updateAuthBtn()
}





window.addEventListener('DOMContentLoaded',init)
</script>
</body>
</html>
